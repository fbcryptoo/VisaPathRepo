<!-- TRUNCATED: The top part of your index.html remains unchanged -->

<!-- Add this to your existing HTML just before </body> -->
<script>
    const passportOptions = {{passport_json}};
    const destinationOptions = {{destination_json}};

    document.addEventListener("DOMContentLoaded", () => {
        const passportSelect = document.querySelector("select[name='passport']");
        const destinationSelect = document.querySelector("select[name='destination']");
        const resultBox = document.createElement('div');
        resultBox.className = "mt-8 p-6 rounded-xl bg-white border border-gray-200 text-lg text-gray-800 shadow-md";
        document.querySelector(".glass-effect").appendChild(resultBox);

        function populateSelect(selectElement, options) {
            selectElement.innerHTML = '';
            options.forEach(country => {
                const option = document.createElement('option');
                option.value = country;
                option.textContent = country;
                selectElement.appendChild(option);
            });
        }

        // Populate and default selects
        populateSelect(passportSelect, passportOptions);
        populateSelect(destinationSelect, destinationOptions);
        passportSelect.value = passportOptions[0];
        destinationSelect.value = destinationOptions[0];

        document.querySelector("button").addEventListener("click", () => {
            const passport = passportSelect.value;
            const destination = destinationSelect.value;

            fetch("combined_passport_data_with_guidance.csv")
                .then(res => res.text())
                .then(csv => {
                    const rows = csv.trim().split("\n").slice(1);
                    const result = rows
                        .map(row => row.split(","))
                        .find(r => r[0] === passport && r[1] === destination);

                    if (result) {
                        const [,, requirement, link, guidance] = result;
                        let msg = '';

                        if (requirement.toLowerCase().includes("visa required")) {
                            msg += `You need a visa to travel to ${destination}. `;
                            if (link) msg += `<a href="${link}" target="_blank" class="text-blue-600 underline">Get more info here</a>. `;
                        } else if (requirement.toLowerCase().includes("e-visa") || requirement.toLowerCase().includes("eta") || requirement.toLowerCase().includes("esta")) {
                            msg += `You can apply online for an ${requirement.toUpperCase()} to travel to ${destination}. `;
                            if (link) msg += `<a href="${link}" target="_blank" class="text-blue-600 underline">Apply here</a>. `;
                        } else {
                            msg += `You ${requirement.toLowerCase()} to travel to ${destination}.`;
                        }

                        if (guidance && guidance !== "nan") {
                            msg += ` <br><br><strong>Note:</strong> ${guidance}`;
                        }

                        resultBox.innerHTML = msg;
                    } else {
                        resultBox.innerHTML = `No visa data available for ${passport} to ${destination}.`;
                    }
                });
        });
    });
                              </script>
